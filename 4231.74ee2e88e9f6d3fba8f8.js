"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[4231],{74231:function(e,t,s){s.d(t,{o:function(){return _e}});var r=s(41820),i=s(23572),n=s(52266),a=s(61866),o=s(85953),c=s(91954),l=s(6538),h=s(71291),u=s(56717);function d(e){let{pixelDimensions:t,texelDimensions:s,baseSize:r,referenceSize:n,strokeWidth:a,sizeRatio:o}=e;if(t||(t=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),s||(s=e.sprite.sdf?[0,0]:t),null!=e.patternHeight){const s=e.patternHeight/t[1];t[1]*=s,t[0]*=s}-1===r&&(r=t[1]),r=(0,i.Lz)(r),n=(0,i.Lz)(n),a=(0,i.Lz)(a);const c=(e.sprite.sdfDecodeCoeff??1)*o;return{...e,pixelDimensions:t,texelDimensions:s,baseSize:r,referenceSize:n,strokeWidth:a,sdfDecodeCoeff:c}}var m=s(43442),p=s(77330);class f extends h.${get vertexSpec(){return{createComputedParams:d,optionalAttributes:{zoomRange:u.jo,value1Position2Value2:u.Z6,lineLength:u.bU},attributes:{id:u.id,bitset:u.Q5,pos:u.n1,offset:u.cY.marker,uv:u.uv.marker,animationPointerAndBaseSizeAndReferenceSize:u.GE,sizing:u.ve,angle:u.g7}}}_write(e,t){const s=this.evaluatedMeshParams.sprite,{textureBinding:r}=s;e.recordStart(this.instanceId,this.attributeLayout,r);const i=t.getDisplayId();if(this.shift&&"esriGeometryPolyline"===t.geometryType)this._writeParticles(e,t);else if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t);else if("esriGeometryPolygon"===t.geometryType){const s=t.readCentroidForDisplay();if(!s)return;const[r,n]=s.coords;this._writeQuad(e,i,r,n)}else if("esriGeometryPoint"===t.geometryType){const s=t.readXForDisplay(),r=t.readYForDisplay();this._writeQuad(e,i,s,r)}else{const s=t.readGeometryForDisplay();s&&s.forEachVertex(((t,s)=>{this._writeQuad(e,i,t,s)}))}e.recordEnd()}_writePlacedMarkers(e,t){const s=n.z.fromFeatureSetReaderCIM(t)?.clone();if(!s)return;const r=c.l.getPlacement(s,-1,this.evaluatedMeshParams.placement,(0,i.Lz)(1),e.id,(0,m.z)());if(!r)return;const o=t.getDisplayId();let l=r.next(),h=null;for(;null!=l;){const t=l.tx,s=-l.ty;if(Math.abs(t)>a.$u||Math.abs(s)>a.$u){l=r.next();continue}const i=-l.getAngle();e.recordBounds(t,s,64,64),this.shift?h&&this._writeQuad(e,o,h[0],h[1],void 0,i):this._writeQuad(e,o,t,s,void 0,i),h=[t,s],l=r.next()}}_writeParticles(e,t){const s=t.getDisplayId(),r=t.readGeometryForDisplay();if(!r)return;const i=[];r.forEachVertex(((e,t)=>{i.push([e,t])}));const n=function(e){const t=[];let s=0;for(let r=1;r<e.length;r++){const i=e[r-1],n=e[r],a=n[0]-i[0],o=n[1]-i[1],c=Math.sqrt(a*a+o*o),l=a/c,h=o/c;t.push({a:{position:i,distance:s,direction:[l,h]},b:{position:n,distance:s+c,direction:[l,h]}}),s+=c}return t}(i);let a=0;for(let e=1;e<i.length;e++){const t=i[e][0]-i[e-1][0],s=i[e][1]-i[e-1][1],r=Math.sqrt(t*t+s*s);a+=r}const c=t=>{for(const r of n){const{a:i,b:n}=r;this._writeQuad(e,s,i.position[0],i.position[1],[i.distance-t,n.position[0],n.position[1],n.distance-t],this.evaluatedMeshParams.angleToLine?Math.atan2(i.direction[1],i.direction[0]):0,a,!0)}},{placement:l}=this.evaluatedMeshParams;if(!l||"placementTemplate"in l||"CIMMarkerPlacementOnVertices"===l.type){let e;if(l&&"CIMMarkerPlacementOnVertices"!==l.type)e=l.placementTemplate;else{e=[0];for(const t of n){const{a:s,b:r}=t,i=s.position[0]-r.position[0],n=s.position[1]-r.position[1],a=Math.sqrt(i*i+n*n);e.push(a)}}let t=-1*a;for(;t<2*a;)for(const s of e)t+=s,c(t)}else"CIMMarkerPlacementAtExtremities"===l.type?l.extremityPlacement===o.$2.JustBegin?c(1):l.extremityPlacement===o.$2.JustEnd?(c(a-1),c(-1)):l.extremityPlacement===o.$2.Both&&(c(1),c(a-1)):"CIMMarkerPlacementOnLine"===l.type&&c(a/2)}_writeQuad(e,t,s,r,i,n=0,a=0,o=!1){const c=this.evaluatedMeshParams.sprite,{rect:h}=c,u=h.x+l.hM,d=h.y+l.hM,m=h.x+h.width-l.hM,f=h.y+h.height-l.hM,_=e.vertexCount();o||e.recordBounds(s,r,64,64);const y={texXmin:u,texYmin:d,texXmax:m,texYmax:f,value1Position2Value2:i,angle:n/p.rp,lineLength:a};for(let i=0;i<4;i++)this._writeVertex(e,t,s,r,y);e.indexEnsureSize(6),e.indexWrite(_),e.indexWrite(_+1),e.indexWrite(_+2),e.indexWrite(_+1),e.indexWrite(_+3),e.indexWrite(_+2)}}class _ extends f{constructor(){super(...arguments),this.shift=!1}}class y extends f{constructor(){super(...arguments),this.shift=!0}}var g=s(73274),v=s(93548),P=s(51917),x=s(98721);class M extends h.${_write(e,t,s){const r=s??n.z.fromFeatureSetReaderCIM(t);if(!r)return;const i=this.evaluatedMeshParams.sprite,{textureBinding:a}=i;e.recordStart(this.instanceId,this.attributeLayout,a);const o=t.getDisplayId();this._writePoly(e,o,r.asOptimized()),e.recordEnd()}}class w extends M{constructor(){super(...arguments),this.vertexSpec={createComputedParams:d,attributes:{id:u.id,bitset:u.Q5,pos:u.n1,offset:u.cY.fill,tlbr:u.Tx,animationPointerAndBaseSizeAndReferenceSize:u.GE,sizing:u.ve},optionalAttributes:{zoomRange:u.jo,value1Position2Value2:u.k3,lineLength:u.Sy}}}_writePoly(e,t,s){const r=[];if(!(0,v.lO)(r,s))return;const i=e.vertexCount();s.forEachVertex(((s,r)=>{this._writeVertex(e,t,s,r)})),e.indexEnsureSize(r.length);for(const t of r)e.indexWrite(i+t)}}class b{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}}class I extends M{constructor(){super(...arguments),this.vertexSpec={createComputedParams:d,attributes:{id:u.id,bitset:u.Q5,pos:u.n1,offset:u.cY.line,tlbr:u.Tx,animationPointerAndBaseSizeAndReferenceSize:u.GE,sizing:u.ve,accumulatedDistance:u.YE,normal:u.qb,segmentDirection:u.zK},optionalAttributes:{zoomRange:u.jo,value1Position2Value2:u.k3,lineLength:u.bU}},this._tessParams=new x.sp,this._currentWrite=new b,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._lineLength=0,this._lineTessellator=new g.i(((e,t,s,r,i,n,a,o,c,l,h)=>this._writeTesselatedVertex(e,t,s,r,i,n,a,o,c,l,h,this._lineLength)),this._writeTriangle.bind(this),!1)}_writePoly(e,t,s){const r=(0,v.uS)(n.z.fromOptimized(s,"esriGeometryPolyline"),64);if(null==r)return;const{_currentWrite:a,_tessellationOptions:c}=this,{baseSize:l,capType:h,joinType:u,miterLimit:d}=this.evaluatedMeshParams,m=(0,i.Lz)(.5*l);c.halfWidth=m,c.capType=(0,P.ue)(h||o.uT.Round),c.joinType=(0,P.qE)(u||o.wd.Round),c.miterLimit=d||2,a.out=e,a.id=t,a.vertexCount=0,a.indexCount=0,a.vertexFrom=e.vertexCount(),a.vertexBounds=1;for(const{line:e,start:t,pathLength:s}of r){c.initialDistance=t%65535,a.pathLength=s,this._lineLength=0;for(let t=1;t<e.length;t++){const s=e[t].x-e[t-1].x,r=e[t].y-e[t-1].y;this._lineLength+=Math.sqrt(s*s+r*r)}this._lineTessellator.tessellate(e,c,false)}}_writeTesselatedVertex(e,t,s,r,i,n,a,o,c,l,h,u){const{out:d,id:m,vertexBounds:p,pathLength:f}=this._currentWrite;return this.hasEffects&&d.recordBounds(e,t,p,p),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=o,this._tessParams.normalX=c,this._tessParams.normalY=l,this._tessParams.directionX=i,this._tessParams.directionY=n,this._tessParams.distance=h,this._tessParams.pathLength=f,this._tessParams.lineLength=u,this._writeVertex(d,m,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,s){const{out:r}=this._currentWrite;r.indexEnsureSize(3),r.indexWrite(e),r.indexWrite(t),r.indexWrite(s),this._currentWrite.indexCount+=3}}var z=s(47819),L=s(39313),A=s(64329),S=s(5467),D=s(12962),E=s(90927),k=s(36123),R=s(23695),T=s(20059),C=s(80294),B=s(21332),G=s(94464),W=s(68749),F=s(53334),O=s(14571),Z=s(56560),N=s(5525),V=s(88358),j=s(71345),Q=s(87574),Y=s(29804),$=s(37249);const q=(0,C.Bj)((e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t}));class X extends $.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,s,r){if(this._zoomLevel=r||0,null!=s)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const s=t.readXForDisplay(),r=t.readYForDisplay();this._writePoint(e,s,r,0,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":{const s=t.readCentroidForDisplay();if(!s)return;const[r,i]=s.coords;this._writePoint(e,r,i,0,t);break}case"esriGeometryMultipoint":{let s=0;const r=n.z.fromFeatureSetReader(t);if(r?.nextPath())for(;r.nextPoint();)this._writePoint(e,r.x,r.y,s++,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,s,r,i){const[n,a]=this._getMetricDir(),o=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,l=this.evaluatedMeshParams.labelClassId;return new Q.f(e,l,t,s,r,n,a,o,c,i)}_writePoint(e,t,s,r,i){if(t<0||t>l.CQ||s<0||s>l.CQ)return;const n=this._getShaping();if(!n)return;const a=i.getDisplayId(),o=this.evaluatedMeshParams.labelClassId,c=function(e,t,s){return(0,B.Wm)(`${e}${t}${s}`)}(i.getObjectId(),o,r),[h,u]=this._getMetricDir(),d=this.evaluatedMeshParams.scaleInfo?.maxScale??0,m=this.evaluatedMeshParams.scaleInfo?.minScale??0,p=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new Q.f(a,o,c,t,s,h,u,d,m,p)),this._writeGlyphs(e,a,t,s,n,0,p,void 0,!1),e.metricBoxWrite(n.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:s,verticalAlignment:r}=this.evaluatedMeshParams,i=this.evaluatedMeshParams.repeatLabelDistance||128,n=this._getShaping("middle");if(!n)return;const a=(e,t,s,r)=>this._placeSubdivGlyphs(e,t,s,r),o=(n.bounds.width+i)/2;this._current={out:e,id:t.getDisplayId(),objId:t.getObjectId(),shaping:n,zoomRange:(0,P.My)(s,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null,pathIndex:0},this._verticalPlacement="bottom"===r?"above":"top"===r?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,o):this._writeCenterAlong(t,a,o)}_writeAboveAndBelowAlong(e,t,s){const{repeatLabel:r}=this.evaluatedMeshParams,{shaping:i}=this._current,n=i.bounds.halfHeight,a=e.readGeometryForDisplay();if(!a)return;const o=new V.A;(0,N.kz)(o,a,!1,!1,"esriGeometryPolyline",1);const c=J(new V.A,o,n),l=J(new V.A,o,-n),h=(0,N.zv)(l,"esriGeometryPolyline",!1,!1),u=(0,N.zv)(c,"esriGeometryPolyline",!1,!1),d=(0,Y.Zy)(u.paths,i.bounds.width),m=(0,Y.Zy)(h.paths,i.bounds.width);this._current.offsetDirection="above";for(let e=0;e<d.length;e++)this._current.pathIndex=e,(0,Y.Nd)(d[e],s,t,!!r);this._current.offsetDirection="below";for(let e=0;e<m.length;e++)this._current.pathIndex=e,(0,Y.Nd)(m[e],s,t,!!r)}_writeCenterAlong(e,t,s){const{repeatLabel:r}=this.evaluatedMeshParams,{shaping:i}=this._current,n=(0,Y.Zy)(e.readLegacyGeometryForDisplay().paths,i.bounds.width);for(let e=0;e<n.length;e++)this._current.pathIndex=e,(0,Y.Nd)(n[e],s,t,!!r)}_placeSubdivGlyphs(e,t,s,r){const{allowOverrun:i,labelPosition:n,repeatLabelDistance:a}=this.evaluatedMeshParams,o=this._current.zoomRange[0],c=q(t),l=this._current.shaping.bounds.width/2,h=Math.sqrt(a||128)/2,u=Math.min(s,r-s),d=this._current.shaping.isMultiline?$.GJ:Math.log2(u/(h+l/2)),m=0===t?d:Math.min(c,d),p=Math.max(o,this._zoomLevel+1-m),f=this._zoomLevel-p,_=this._current.shaping.bounds.width/2*2**f,y=function(e,t,s,r,i){return(0,B.Wm)(`${e}${i}${t}${s*2**($.GJ-r)}`)}(this._current.objId,this._current.pathIndex,t,this._zoomLevel,this.evaluatedMeshParams.labelClassId);this._current.shaping.isMultiline?0===t&&this._placeStraight(e,p,y):i&&f<0?this._placeStraightAlong(e,o,y):"parallel"===n?this._placeStraightAlong(e,p,y):"curved"===n&&this._placeCurved(e,p,_,y)}_placeStraight(e,t,s){const{out:r,id:i,shaping:n,referenceBounds:a}=this._current,{x:o,y:c}=e;r.metricStart(this._createLineLabelMetric(i,s,o,c)),r.metricBoxWrite(n.boundsT);const l=e.angle*(180/Math.PI)%360,h=(e.angle*(180/Math.PI)+180)%360,u={clipAngle:l,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(r,i,o,c,n,0,a,u,!1);const d={clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(r,i,o,c,n,0,a,d,!1),r.metricEnd()}_placeCurved(e,t,s,r){const{out:i,id:n}=this._current;i.metricStart(this._createLineLabelMetric(n,r,e.x,e.y));const a=e.clone(),o=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(a,t,1,o),this._placeBack(e,a,t,s,1,o),this._placeForward(e,a,t,s,1,o)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(a,t,0,c),this._placeBack(e,a,t,s,0,c),this._placeForward(e,a,t,s,0,c)),i.metricEnd()}_placeStraightAlong(e,t,s){const{out:r,id:n,shaping:a,zoomRange:o,referenceBounds:c}=this._current,{boxBorderLineColor:l,boxBackgroundColor:h}=this.evaluatedMeshParams,u=e.clone(),d=e.angle*(180/Math.PI)%360,m=(e.angle*(180/Math.PI)+180)%360,p=a.glyphs.length>0&&!(!l&&!h);if(r.metricStart(this._createLineLabelMetric(n,s,e.x,e.y)),p){const s=Math.max(t,o[0],0),l=Math.min($.GJ,o[1]),h=(0,G.$0)((0,W.vt)(),-e.angle),u={minZoom:s,maxZoom:l,clipAngle:d,mapAligned:!0,isLineLabel:!0},p=(0,i.Lz)(this.evaluatedMeshParams.offsetX),f=(0,i.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=(0,O.fA)(p,-1*f),[s,i]=a.shapeBackground((0,G.Tl)((0,W.vt)(),h,t));r.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding),this._writeTextBox(r,n,e.x,e.y,i,c,u),r.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=(0,O.fA)(p,f),[s,i]=a.shapeBackground((0,G.Tl)((0,W.vt)(),h,t));u.clipAngle=m,r.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding),this._writeTextBox(r,n,e.x,e.y,i,c,u),r.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(u,t,1,d,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(u,t,0,m,!0),r.metricEnd()}_placeBack(e,t,s,r,i,n){const a=e.clone();let o=e.backwardLength+0;for(;a.prev()&&!(o>=r);)this._placeOnSegment(a,t,o,s,-1,i,n),o+=a.length+0}_placeForward(e,t,s,r,i,n){const a=e.clone();let o=e.remainingLength+0;for(;a.next()&&!(o>=r);)this._placeOnSegment(a,t,o,s,1,i,n),o+=a.length+0}_placeFirst(e,t,s,r,n=!1){const{out:a,id:o,shaping:c,zoomRange:l,referenceBounds:h}=this._current,u=c.glyphs,d=(0,i.Lz)(this.evaluatedMeshParams.offsetX),m=(0,i.Lz)(this.evaluatedMeshParams.offsetY),p=(0,O.fA)(d,m),f=(0,G.$0)((0,W.vt)(),-e.angle);(0,F.l0)(p,p,f);for(const i of u){const u=i.x>c.bounds.x?s:1-s,d=u*e.remainingLength+(1-u)*e.backwardLength,m=Math.abs(i.x+i.width/2-c.bounds.x),f=Math.max(0,this._zoomLevel+Math.log2(m/(d+0))),_=Math.max(t,n?0:f);if(i.maxZoom=Math.min(l[1],$.GJ),i.angle=e.angle+(1-s)*Math.PI,i.minZoom=Math.max(l[0],_),this._writeLineGlyph(a,o,e.x,e.y,i,r,h,!0),(s||this._current.offsetDirection)&&this._isVisible(i.minZoom,i.maxZoom)){const e=new j.A(i.bounds.x+p[0],i.bounds.y+p[1],i.bounds.width,i.bounds.height);a.metricBoxWrite(e)}}}_placeOnSegment(e,t,s,r,n,a,o){const{out:c,id:l,shaping:h,referenceBounds:u}=this._current,d=h.glyphs,m=e.dx/e.length,p=e.dy/e.length,f={x:e.x+s*-n*m,y:e.y+s*-n*p},_=(0,i.Lz)(this.evaluatedMeshParams.offsetX),y=(0,i.Lz)(this.evaluatedMeshParams.offsetY),g=(0,O.fA)(_,y),v=(0,G.$0)((0,W.vt)(),-e.angle);(0,F.l0)(g,g,v);for(const t of d){const i=t.x>h.bounds.x?a:1-a;if(!(i&&1===n||!i&&-1===n))continue;const d=Math.abs(t.x+t.width/2-h.bounds.x),m=Math.max(0,this._zoomLevel+Math.log2(d/s)-.1),p=Math.max(r,this._zoomLevel+Math.log2(d/(s+e.length+0)));if(0!==m&&(t.angle=e.angle+(1-a)*Math.PI,t.minZoom=p,t.maxZoom=m,this._writeLineGlyph(c,l,f.x,f.y,t,o,u,!0),(a||this._current.offsetDirection)&&this._isVisible(t.minZoom,t.maxZoom))){const e=new j.A(t.bounds.x+g[0],t.bounds.y+g[1],t.bounds.width,t.bounds.height);c.metricBoxWrite(e)}}}_writeLineGlyph(e,t,s,r,i,n,a,o){if(s<0||s>l.CQ||r<0||r>l.CQ)return;e.recordStart(this.instanceId,this.attributeLayout,i.textureBinding);const{texcoords:c,offsets:h}=i,{fontSize:u,haloSize:d,outlineSize:m}=this._textMeshTransformProps;this._writeQuad(e,t,s,r,{texcoords:c,offsets:h,fontSize:u,haloSize:d,outlineSize:m,color:(0,P.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:a,minZoom:Math.max(this._current.zoomRange[0],i.minZoom),maxZoom:Math.min(this._current.zoomRange[1],i.maxZoom),clipAngle:n,mapAligned:o,isLineLabel:!0}),e.recordEnd()}_packedZoom(e){return Math.floor(e*l.fq)/l.fq}_isVisible(e,t){let s=Math.max(this._current.zoomRange[0],e),r=Math.min(this._current.zoomRange[1],t);s=this._packedZoom(s),r=this._packedZoom(r);const i=this._packedZoom(this._zoomLevel);return s<=i&&i<=r}}function J(e,t,s){const{coords:r,lengths:i}=t,n=(0,Z.vt)(),a=(0,Z.vt)(),o=(0,Z.vt)(),c=(0,Z.vt)(),l=(0,Z.vt)(),h=(0,Z.vt)();let u=0;for(let t=0;t<i.length;t++){const d=i[t];for(let t=0;t<d;t++){const i=2*(t+u-1),m=2*(t+u),p=2*(t+u+1);t>0?(0,F.hZ)(n,r[i],r[i+1]):(0,F.hZ)(n,0,0),(0,F.hZ)(a,r[m],r[m+1]),t<d-1?(0,F.hZ)(o,r[p],r[p+1]):(0,F.hZ)(o,0,0),0===t?(0,F.hZ)(c,0,0):((0,F.jb)(c,a,n),(0,F.S8)(c,c),(0,F.hZ)(c,c[1],-c[0])),t===d-1?(0,F.hZ)(l,0,0):((0,F.jb)(l,o,a),(0,F.S8)(l,l),(0,F.hZ)(l,l[1],-l[0])),(0,F.WQ)(h,c,l),(0,F.S8)(h,h);const f=h[0]*l[0]+h[1]*l[1];0!==f&&(0,F.hs)(h,h,f),(0,F.hs)(h,h,s),e.coords.push(a[0]+h[0],a[1]+h[1])}e.lengths.push(d),u+=d}return e}var H=s(42375),K=s(43208),U=s(22956),ee=s(3223),te=s(62991),se=s(15565),re=s(80861),ie=s(46279),ne=s(51187),ae=s(7847),oe=s(54631),ce=s(43135),le=s(77377);async function he(e,t,s,r){const{defaultValue:i,valueExpressionInfo:n,value:a}=t;if(n){if("dictionary-template"===n.type)return{...t,computed:e.createDictionaryTemplateField(n,s),defaultValue:i};const{expression:a}=n,o=await e.createComputedField({expression:a},r);return o?{...t,computed:o,defaultValue:i}:null}return{...t,computed:new le.G(a),defaultValue:i}}async function ue(e,t,s){const{valueExpressionInfo:r}=t,i="dictionary-template"===r.type?e.createDictionaryTemplateField(r,s):await e.createComputedField({expression:r.expression});return i?{...t,computed:i}:null}function de(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function me(e){if(Array.isArray(e))for(const t of e)if(me(t))return!0;if("object"==typeof e){if(de(e))return!0;for(const t in e)if(me(e[t]))return!0}return!1}class pe{static async create(e,t,s,r){const i={},n=new Map,a=new Map,o=new Map,c=new Map,l=new Map,h=new Map;for(const u in s){const d=s[u];if(null!=d&&"object"==typeof d)if(Array.isArray(d)){if("object"==typeof d[0])throw new Error(`InternalError: Cannot handle ${u}. Nested array params are not supported`);i[u]=d}else if("valueExpressionInfo"in d){if(d.value){i[u]=d.value;continue}const t=await ue(e,d,r);if(!t){i[u]=d.defaultValue;continue}n.set(u,t),i[u]=null}else switch(d.type){case"cim-effect-infos":if(d.effectInfos.some((e=>e.overrides.length))){a.set(u,{effects:await Promise.all(d.effectInfos.map((async t=>{const s=t.overrides.map((t=>he(e,t,r,!1)));return{effect:t.effect,compiledOverrides:(await Promise.all(s)).filter(ee.Ru)}})))});break}i[u]=d.effectInfos.map((e=>e.effect));break;case"cim-marker-placement-param":d.overrides.length&&o.set(u,{placementInfo:d,compiledOverrides:(await Promise.all(d.overrides.map((t=>he(e,t,r,!1))))).filter(ee.Ru)}),i[u]=d.placement;break;case"text-rasterization-param":{if(d.overrides.length){const t=d.overrides.map((t=>he(e,t,r,d.useLegacyLabelEvaluationRules??!1)));c.set(u,{compiledOverrides:(await Promise.all(t)).filter(ee.Ru),rasterizationParam:d,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:d.resource};i[u]=await t.fetchResourceImmediate(s)??null;break}case"sprite-rasterization-param":{if(d.overrides.length){const t=d.overrides.map((t=>he(e,t,r,!1)));c.set(u,{compiledOverrides:(await Promise.all(t)).filter(ee.Ru),rasterizationParam:d,objectIdToResourceId:new Map});continue}if("animated"===d.resource.type){c.set(u,{compiledOverrides:[],rasterizationParam:d,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:d.resource};i[u]=await t.fetchResourceImmediate(s)??null;break}case"cim-marker-transform-param":{const{params:t}=d;if(me(t)){const s={compiledMarkerInfos:[]};await Promise.all(t.map((async t=>{const i={props:{}};for(const s in t)if(de(t[s])){const n=await ue(e,t[s],r);i.compiledExpressionMap||(i.compiledExpressionMap=new Map);const a=i.compiledExpressionMap;n&&a.set(s,n)}else i.props[s]=t[s];s.compiledMarkerInfos.push(i)}))),l.set(u,s)}else i[u]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:s}=d,r=(0,oe.oo)(s);if(me(r)){const t=await Promise.all(r.map((t=>(0,oe.N)(t,e))));h.set(u,{params:t,propertyIdToResourceId:new Map,key:u})}else{const e=(0,oe.rS)(r),s=await t.fetchResourceImmediate({type:"animation-info",resource:e});null!=s&&"sprite"===s.type&&(i[u]={dataRow:s.rect.y,dataColumn:s.rect.x})}break}default:i[u]=d}else i[u]=d}return new pe(s,i,n,a,o,c,l,h)}constructor(e,t,s,r,i,n,a,o){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=s,this._dynamicEffectProperties=r,this._dynamicPlacementProperties=i,this._dynamicAsyncProperties=n,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=o,this.evaluator=e=>e,this._arcadeDependencies=new Set;for(const e of this._expressions())(0,ie.QY)(this._arcadeDependencies,e)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,s){for(const r of this._dynamicAsyncProperties.values()){const i=(0,se.o8)(r.rasterizationParam.resource);"animated"===r.rasterizationParam.resource.type&&r.rasterizationParam.resource.randomizeStartTime&&(i.primitiveName="__RESERVED__PRIMITIVE__NAME__",i.startGroup=(0,ne.A)(t.getObjectId()||0));for(const{primitiveName:e,propertyName:n,computed:a,defaultValue:o,valueExpressionInfo:c}of r.compiledOverrides)try{const c="animated"===r.rasterizationParam.resource.type?i.primitiveName:e;(0,ce.Ph)(i,c,n,a,t,s,o)}catch(e){re.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new te.A("invalid-arcade-expression","Encountered an error when evaluating the arcade expression",{error:e,valueExpressionInfo:c}))}const n=e.enqueueRequest({type:"cim-rasterization-info",resource:i});r.objectIdToResourceId.set(t.getObjectId(),n)}for(const r of this._dynamicAsyncAnimations.values()){const i=r.params.map((e=>(0,oe.SM)(e,t,s))).map(ae.Qv).map((e=>e.simplify())),n=(0,oe.aM)(i),a=e.enqueueRequest({type:"animation-info",resource:n});r.propertyIdToResourceId.set(t.getObjectId()+"."+r.key,a)}}evaluateMeshParams(e,t,s){for(const[e,r]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=r.computed.readWithDefault(t,s,r.defaultValue);for(const[e,r]of this._dynamicPlacementProperties.entries())for(const{computed:i,defaultValue:n,propertyName:a}of r.compiledOverrides){const o=i.readWithDefault(t,s,n);r.placementInfo.placement[a]=o,this._resolvedMeshParams[e]=r.placementInfo.placement}for(const[e,r]of this._dynamicEffectProperties.entries())for(const i of r.effects){for(const{computed:e,defaultValue:r,propertyName:n}of i.compiledOverrides){const a=e.readWithDefault(t,s,r);i.effect[n]=a}this._resolvedMeshParams[e]=r.effects.map((e=>e.effect))}for(const[e,r]of this._dynamicTransformProperties.entries()){const i={type:"cim-marker-transform-info",infos:[]};for(const e of r.compiledMarkerInfos){const r={...e.props};if(e.compiledExpressionMap)for(const[i,n]of e.compiledExpressionMap){const e=n.computed.readWithDefault(t,s,n.defaultValue);r[i]="number"==typeof e||"boolean"==typeof e?e:n.defaultValue}i.infos.push(r)}this._resolvedMeshParams[e]=i}for(const[s,r]of this._dynamicAsyncProperties.entries()){const i=r.objectIdToResourceId.get(t.getObjectId());if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[s]=n}for(const[s,r]of this._dynamicAsyncAnimations.entries()){const i=r.propertyIdToResourceId.get(t.getObjectId()+"."+s);if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[s]={dataRow:n.rect.y,dataColumn:n.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const e of t.compiledOverrides)yield e.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const e of t.compiledExpressionMap.values())yield e.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*(0,oe.ci)(t)}}var fe=s(33121);class _e{async createMeshWriter(e,t,s,r,i){const n=this._getMeshWriter(r.techniqueType),a=await pe.create(e,t,r.inputParams,i),o=new n(r.id,a,r.optionalAttributes,s);return await o.loadDependencies(),o}_getMeshWriter(e){switch(e){case r.N.Fill:return S.Y;case r.N.DotDensity:return z.k;case r.N.ComplexFill:return L.KE;case r.N.PatternFill:return k.m;case r.N.GradientFill:return D.S;case r.N.OutlineFill:return E.w0;case r.N.PatternOutlineFill:return R.Q;case r.N.ComplexOutlineFill:return A.O;case r.N.Marker:return U.H;case r.N.PieChart:return fe.v;case r.N.Text:return $.G8;case r.N.Line:return x.Bw;case r.N.TexturedLine:return K.K;case r.N.GradientStroke:return H.F;case r.N.Heatmap:return T.h;case r.N.Label:return X;case r.N.AnimatedMarker:return _;case r.N.AnimatedMarkerShift:return y;case r.N.AnimatedFill:return w;case r.N.AnimatedLine:return I;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}},77377:function(e,t,s){s.d(t,{G:function(){return i}});var r=s(13666);class i extends r.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,s){return this._value}hasArcadeDependency(e){return!1}}}}]);