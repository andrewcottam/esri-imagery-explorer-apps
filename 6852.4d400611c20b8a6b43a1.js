"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[6852],{1277:function(e,t,i){i.d(t,{Nu:function(){return s},Y3:function(){return n},in:function(){return r}});var o=i(10628),a=i(65452);function n(e,t,i){if(!t||!e?.map)return;const{map:o}=e,a=o.layers.find((e=>e===t));a||o.add(t,i),a&&null!=i&&o.layers.reorder(a,i)}function r(e,t){const i="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find((e=>{const t=e.layer;return t===i||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(i)}))}function s(e){return(0,o.S)(e)||(0,a.Sv)(e)||(0,a.V0)(e)||(0,a.UC)(e)}},5073:function(e,t,i){i.d(t,{j:function(){return s}});var o=i(23572),a=i(19913),n=i(82320),r=i(84739);function s(e,t,i,a){return"2d"===a.type?(p.x=e[0],p.y=e[1],p.spatialReference=t,a.toScreen(p)):((0,r.X)(e,t,i,a,l),a.state.camera.projectToScreen(l,c),(0,o.tc)(c[0],c[1]))}const p=(0,n.T)(0,0,0,null),l=(0,a.vt)(),c=(0,o.gs)()},6852:function(e,t,i){i.d(t,{RouteLayerInteraction:function(){return Et}});var o=i(82392),a=i(73783),n=i(70214),r=i(57725),s=i(61985),p=i(81482),l=(i(6273),i(80861)),c=(i(67498),i(26325)),h=i(68660),d=i(11682),u=i(70091),y=i(20819),g=i(4991),v=i(33294),m=i(58842),f=i(62991),_=i(57888),b=i(37623),E=i(34670),w=i(34008),S=i(11021),M=i(67488),T=i(65452),O=i(58720),G=i(56173),P=i(55736),C=i(24826),R=i(68231),A=i(4331),k=i(37684),D=i(64010),H=i(19541);function I(e){return function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:k.d.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:k.d.GEOMETRY_MISSING};if((0,H.wz)(e.elevationInfo))return{result:k.d.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return"point"===t||"mesh"===t||"polyline"===t||"polygon"===t?{result:k.d.SUPPORTED,geometry:i}:{result:k.d.GEOMETRY_TYPE_UNSUPPORTED}}(e).result}var U=i(1277),x=i(82795),L=i(92750),N=i(29458),Z=i(3130),F=i(80507),V=i(40135),j=i(3132),B=i(93617),q=i(51879),Y=i(27601),z=i(3223);let W=class extends a.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new m.A}};(0,o._)([(0,p.MZ)({constructOnly:!0})],W.prototype,"layer",void 0),(0,o._)([(0,p.MZ)()],W.prototype,"enabled",void 0),(0,o._)([(0,p.MZ)()],W.prototype,"updating",void 0),(0,o._)([(0,p.MZ)()],W.prototype,"availability",void 0),(0,o._)([(0,p.MZ)()],W.prototype,"sublayerSources",void 0),W=(0,o._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],W);let K=class extends a.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new m.A,this.distance=q.N.distance,this.touchSensitivityMultiplier=q.N.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some($)&&l.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Q),i=this._get("_effectiveFeatureSources")?.filter($)??new m.A;for(const e of t){const t=i.find((t=>t.layer===e.layer.parent));if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){const t=new W({layer:e.layer.parent});t.sublayerSources.add(e),i.add(t)}}for(const e of i){const i=e.sublayerSources.filter((e=>!t.includes(e)));e.sublayerSources.removeMany(i)}i.removeMany(i.filter((e=>0===e.sublayerSources.length)));const o=e.filter(X),a=this._get("_effectiveFeatureSources")??new m.A,{added:n,removed:r}=(0,z.iv)(a.toArray(),[...o,...i]);return a.removeMany(r),a.addMany(n),a}};function $(e){return"subtype-group"===e.layer.type}function X(e){return"subtype-group"!==e.layer.type}function Q(e){return"subtype-sublayer"===e.layer.type}(0,o._)([(0,p.MZ)()],K.prototype,"enabled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"enabledToggled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"forceDisabled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"selfEnabled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"featureEnabled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"gridEnabled",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"attributeRulesEnabled",void 0),(0,o._)([(0,p.MZ)({type:m.A.ofType(W)})],K.prototype,"featureSources",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"distance",void 0),(0,o._)([(0,p.MZ)()],K.prototype,"touchSensitivityMultiplier",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],K.prototype,"effectiveEnabled",null),(0,o._)([(0,p.MZ)({readOnly:!0})],K.prototype,"effectiveGridEnabled",null),(0,o._)([(0,p.MZ)({readOnly:!0})],K.prototype,"effectiveSelfEnabled",null),(0,o._)([(0,p.MZ)({readOnly:!0})],K.prototype,"effectiveFeatureEnabled",null),(0,o._)([(0,p.MZ)({readOnly:!0})],K.prototype,"_effectiveFeatureSources",null),K=(0,o._)([(0,c.$)("esri.views.interactive.snapping.SnappingOptions")],K);var J=i(76362),ee=i(88515),te=i(62453),ie=i(53909),oe=i(28488),ae=i(95101),ne=i(48257),re=i(57945),se=i(5073),pe=i(7743),le=i(19913),ce=i(38648),he=i(65680),de=i(22538),ue=i(7540);function ye(e,t,i){return(0,ue.M0)(i,me,fe,e,t,i)}const ge={geodesicLength:function(e){const{spatialReference:t}=e;return(0,ue.M0)(t,_e,be,e)},geodesicDistanceBetweenPoints:function(e,t){if(!(0,M.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return we[0]=e.x,we[1]=e.y,we[2]=e.hasZ?e.z:0,Se[0]=t.x,Se[1]=t.y,Se[2]=t.hasZ?t.z:0,ye(we,Se,i)},geodesicDistance:ye};async function ve(){return await(0,he.l)(),ge}function me(e,t,i){return(0,pe.d_)((0,de._3)(Ee,e,t,i).distance,"meters")}function fe(e,t,i){return(0,pe.d_)((0,he.e)(function(e,t,i){return new ce.A({spatialReference:i,paths:[[[...e],[...t]]]})}(e,t,i),{unit:"meters"}),"meters")}function _e(e){return(0,pe.d_)((0,de.l1)([e],"meters")[0],"meters")}function be(e){return(0,pe.d_)((0,he.e)(e,{unit:"meters"}),"meters")}const Ee=new de.Zj,we=(0,le.vt)(),Se=(0,le.vt)();let Me=class extends(_.A.EventedMixin(a.A)){constructor(e){super(e),this.options=new K,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Te.MAIN}initialize(){this.addHandles([(0,s.wB)((()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:o,effectiveGridEnabled:a}=this.options;return{selfEnabled:i,featureEnabled:o,gridEnabled:"2d"===this.view.type&&a,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}}),((e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=(0,j.UT)((i=>this._updateEngines(e,t,i)))}),s.pc),(0,s.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),s.OH)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach((e=>e.destroy())),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const o=this._engineCache,a=await Promise.allSettled([e.featureEnabled&&!o.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!o.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!o.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const e of a)"fulfilled"===e.status&&e.value?.engine.destroy();else{for(const e of a)"fulfilled"===e.status&&e.value&&o.set(e.value.type,e.value.engine);this._engines=Array.from(o.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},o]=await Promise.all([i.e(4060).then(i.bind(i,24060)),ve()]);return(0,b.Te)(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:o})}}async _createGridSnappingEngine(e){const{view:t}=this;if("2d"!==t.type)return;const{GridSnappingEngine:o}=await i.e(72).then(i.bind(i,90072));return(0,b.Te)(e),{type:"grid",engine:new o({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await i.e(2652).then(i.bind(i,92652));(0,b.Te)(e);const{view:o,options:a}=this,{spatialReference:n}=o;return{type:"feature",engine:new t({view:o,options:a,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const o=this._currentMainCandidate;if(null==o)return t;const a=this._selectUpdateInput(e);if(null==a)return t;const{spatialReference:n}=i,r=(0,w.project)(a,n);if(null==r)return t;const{view:s}=this,{elevationInfo:p,visualizer:l}=i,c=[],h=(0,B.vf)(r,s,p),d=o.constraint.closestTo(h);if(!this._arePointsWithinScreenThreshold(h,d,i)||!Pe(o,i.drawConstraints))return this._resetSnappingState(),t;o.targetPoint=(0,B.de)(d),c.push(...o.hints);for(const e of this._currentOtherActiveCandidates)Pe(e,i.drawConstraints)&&(e.targetPoint=(0,B.de)(d),c.push(...e.hints));return null!=l&&this.addHandles(l.draw(c,{spatialReference:n,elevationInfo:Re(i),view:s,selfSnappingZ:i.selfSnappingZ}),Ge),(0,B.xF)(d,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case Te.MAIN:return e;case Te.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Te.MAIN}_removeVisualization(){this.removeHandles(Ge)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:o}=this,{elevationInfo:a}=t,n=(0,B.vf)(e,o,a),r=await this._fetchCandidates(n,Y.n.ALL,t,i);return this._createSnapResult(n,Te.MAIN,r,o,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:o}){const{view:a}=this,{coordinateHelper:n,elevationInfo:r,spatialReference:s}=i;await(0,w.initializeProjection)(t.spatialReference,s);const p=(0,w.project)(t,s),l=(0,B.vf)(p,a,r),c=await this._fetchCandidates(l,Y.n.FEATURE,i,o);if(c.length>0){const e=await this._fetchCandidates(l,Y.n.SELF,i,o);return this._createSnapResult(l,Te.SCENE,[...c,...e],a,p,i,o)}const h=(0,B.vf)(e,a,r),d=await this._fetchCandidates(h,Y.n.SELF,i,o);return this._createSnapResult(h,Te.MAIN,d,a,{z:n.hasZ()&&e.hasZ?e.z??0:void 0,m:n.hasM()&&e.hasM?e.m??0:void 0},i,o)}async _fetchCandidates(e,t,i,o){return(await Promise.all(this._engines.map((a=>a.fetchCandidates(e,t,i,o))))).flat()}_createSnapResult(e,t,i,o,a,n,r){return{get valid(){return!(0,b.G4)(r)},apply:()=>{const{spatialReference:r}=n,{snappedPoint:s,hints:p}=this._processCandidates(e,t,i,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(p,{spatialReference:r,elevationInfo:H.qt,view:o,selfSnappingZ:n.selfSnappingZ}),Ge),(0,B.xF)(s,o,a,n)}}}_processCandidates(e,t,i,o){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,J.xX)(e,i);const a=this._currentMainCandidate;if(null!=a){const n=function(e,t){return e instanceof ie.N?Ce(t,e.first)>=0&&Ce(t,e.second)>=0?0:-1:Ce(t,e)}(a,i);if(n>=0){if(!(i[n]instanceof ie.N))return this._intersectWithOtherCandidates(n,i,e,t,o);if(this._arePointsWithinScreenThreshold(e,a.targetPoint,o))return this._updateSnappingCandidate(a,t,i,o)}}return this._intersectWithOtherCandidates(0,i,e,t,o)}_intersectWithOtherCandidates(e,t,i,o,a){const{coordinateHelper:n}=a,r=t[e],s=[];for(let o=0;o<t.length;++o){if(o===e)continue;const a=t[o],p=r.constraint.intersect(a.constraint);if(p)for(const e of p.closestPoints(r.targetPoint))s.push([new ie.N((0,B.de)(e),r,a,a.isDraped),this._squaredScreenDistance(i,e,n)])}return s.length>0&&(s.sort(((e,t)=>e[1]-t[1])),s[0][1]<this._squaredPointProximityThreshold(a.pointer))?this._updateSnappingCandidate(s[0][0],o,t,a):Pe(r,a.drawConstraints)?this._updateSnappingCandidate(r,o,t,a):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,o){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const a=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const t of i){if(e instanceof ie.N){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;const i=t.constraint.closestTo(a);this._squaredScreenDistance(i,a,o.coordinateHelper)<q.N.satisfiesConstraintScreenThreshold*q.N.satisfiesConstraintScreenThreshold&&(t.targetPoint=a,this._currentOtherActiveCandidates.push(t),n.push(...t.hints))}return{snappedPoint:a,hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,J.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,se.j)(e,t.spatialReference,H.qt,this.view)}get test(){}};var Te,Oe;(0,o._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"view",void 0),(0,o._)([(0,p.MZ)()],Me.prototype,"options",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],Me.prototype,"updating",null),(0,o._)([(0,p.MZ)()],Me.prototype,"_loadTask",void 0),(0,o._)([(0,p.MZ)()],Me.prototype,"_engines",void 0),(0,o._)([(0,p.MZ)()],Me.prototype,"_squaredMouseProximityThreshold",null),(0,o._)([(0,p.MZ)()],Me.prototype,"_squaredTouchProximityThreshold",null),Me=(0,o._)([(0,c.$)("esri.views.interactive.snapping.SnappingManager")],Me),(Oe=Te||(Te={}))[Oe.MAIN=0]="MAIN",Oe[Oe.SCENE=1]="SCENE";const Ge="visualization-handle";function Pe(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof ee.X||e instanceof te.z||e instanceof oe.o||e instanceof ae.B||e instanceof re.R)&&(!(e instanceof ne.HJ)||null==t.direction&&e.selfSnappingType===ne._b.LastVertex)}function Ce(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.equals(e[o].constraint)){i=o;break}return i}function Re({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?H.qt:t}var Ae=i(5262),ke=i(91814),De=i(80347),He=i(42722),Ie=i(87368),Ue=i(45660),xe=i(21403);function Le(e,t,i=e.hasZ){const o=(0,xe.l)(e.spatialReference),a=(0,Ae.B5)(o);if(null==a)return null;const n=(e,t)=>!(t.length<2||((0,De.i)(e,t[0],t[1],i&&t[2]||0),0));let r=0;for(const i of e.rings){const a=i.length;if(a<3)continue;const{positionsWorldCoords:s}=t;for(;s.length<a;)s.push((0,le.vt)());const p=Ne,l=(0,De.i)(Ze,0,0,0),c=1/a;for(let t=0;t<a;t++){if(!n(p,i[t]))return null;if(!(0,He.F)(p,e.spatialReference,s[t],o))return null;(0,De.b)(l,l,s[t],c)}const h=(0,Ie.Cr)(s[0],s[1],l,(0,Ie.LV)());if(0===(0,De.k)((0,Ie.Qj)(h)))continue;for(let e=0;e<a;e++)(0,Ie.Z1)(h,l,s[e],s[e]);const d=Fe(s);for(let e=0;e<d.length;e+=3)r+=(0,Ue.Fm)(s[d[e]],s[d[e+1]],s[d[e+2]])}return(0,pe.gT)(r,a)}const Ne=(0,le.vt)(),Ze=(0,le.vt)();function Fe(e){return(0,ke.e)(function(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const o=e[i],a=2*i;t[a]=o[0],t[a+1]=o[1]}return t}(e),[],2)}const Ve=e=>({geodesicArea(t){const{spatialReference:i}=t;return(0,ue.M0)(i,je,(t=>function(e,t){try{return(0,pe.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(e){return null}}(e,t)),t)}});function je(e){return(0,pe.gT)(Math.abs((0,de.qy)([e],"square-meters")[0]),"square-meters")}const Be=e=>({autoAreaByElevationMode(t,i,o={positionsWorldCoords:[]}){if("on-the-ground"===i){const i=e.geodesicArea(t);return null!=i?i:function(e,t={positionsWorldCoords:[]}){return Le(e,t,!1)}(t,o)}return function(e,t={positionsWorldCoords:[]}){return Le(e,t)}(t,o)},autoArea2D(e,t={positionsWorldCoords:[]}){return this.autoAreaByElevationMode(e,"on-the-ground",t)}});let qe=null;async function Ye(){return qe||(qe=Be(await async function(){const e=await Promise.all([i.e(7313),i.e(5670)]).then(i.bind(i,65670));return Ve(e)}())),qe}var ze=i(68489);async function We(){return function(e){return{autoLength2D:t=>e.geodesicLength(t)??(0,ze.Xg)(t),autoDistanceBetweenPoints2D:(t,i)=>e.geodesicDistanceBetweenPoints(t,i)??(0,ze.ll)(t,i),autoDistance2D:(t,i,o)=>(Ke[0]=t[0],Ke[1]=t[1],Ke[2]=3===t.length?t[2]:0,$e[0]=i[0],$e[1]=i[1],$e[2]=3===i.length?i[2]:0,e.geodesicDistance(Ke,$e,o)??(0,ze.sT)(Ke,$e,o))}}(await ve())}const Ke=(0,le.vt)(),$e=(0,le.vt)();var Xe=i(83882),Qe=i(17780),Je=i(20405),et=i(17420);let tt=class extends _.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,et.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,o._)([(0,p.MZ)()],tt.prototype,"activeComponent",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"cancelled",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"history",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"tool",null),(0,o._)([(0,p.MZ)()],tt.prototype,"type",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"canUndo",null),(0,o._)([(0,p.MZ)()],tt.prototype,"canRedo",null),(0,o._)([(0,p.MZ)()],tt.prototype,"onEnd",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"undo",null),(0,o._)([(0,p.MZ)()],tt.prototype,"redo",null),(0,o._)([(0,p.MZ)()],tt.prototype,"toggleTool",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"addToSelection",void 0),(0,o._)([(0,p.MZ)()],tt.prototype,"removeFromSelection",void 0),tt=(0,o._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle")],tt);let it=class extends tt{};(0,o._)([(0,p.MZ)()],it.prototype,"activeComponent",void 0),it=(0,o._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],it);let ot=class extends tt{};var at;(0,o._)([(0,p.MZ)()],ot.prototype,"activeComponent",void 0),ot=(0,o._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],ot),function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"}(at||(at={}));const nt={defaultZ:0},rt={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Xe.Tv},tool:"transform"};let st=class extends _.A.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new h.U,this._internalGraphicsLayer=new d.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new R.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new P.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new C.A({color:[130,130,130,1],width:2}),this.meshSymbol=new G.A({symbolLayers:new m.A([new O.A])}),this.updateGraphics=new m.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new R.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Z.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=nt,this.defaultUpdateOptions=rt,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new K}initialize(){this.addHandles([(0,s.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,s.on)((()=>this.layer?.graphics),"change",(e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,s.wB)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),s.pc),(0,s.wB)((()=>this.view),(e=>{this._defaultSnappingManager=(0,r.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new Me({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(8004),i.e(4394),i.e(9218),i.e(866)]).then(i.bind(i,98954)):"3d"===e.type&&(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375)),Promise.all([i.e(9507),i.e(9644),i.e(356),i.e(4103),i.e(2872),i.e(1843),i.e(2501)]).then(i.bind(i,51514))))}),s.pc),(0,s.wB)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))]),(0,J.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,r.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...nt,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...rt,...e,reshapeOptions:{...rt.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...rt.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,r.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new Me({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles((0,s.z7)((()=>e.ready),(t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)}),s.pc),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,r.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,r.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map((e=>e.clone())).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:o}=this;if(!i||"disabled"===this.state)throw o||this._logMissingLayer(),(0,b.NK)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,U.Y3)(i,this._internalGraphicsLayer);const a=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==a||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);a.on("complete",(()=>{if(a===this._operationHandle){const i=this.createGraphic,n=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||null==i||o.add(i),this._sketchContinuationFlag=!1,this.emit("create",{graphic:i,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),n||this._sketchContinuationFlag)return;const{creationMode:r}=this;if("continuous"===r){if(t?.geometryToPlace)return;this._updatingHandles.addPromise((0,b.QZ)(this.create(e,t)))}else"update"===r&&i&&this._updatingHandles.addPromise((0,b.QZ)(this.update([i])))}})),this._operationHandle=a,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:a}=this;if(!o||"disabled"===a)throw i||this._logMissingLayer(),(0,b.NK)();null!=o.activeTool&&(o.activeTool=null);const n=Array.isArray(e)?e:[e];if(null==e||!n?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const r=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,t));this.destroyed||null==r||mt(r)||((0,U.Y3)(o,this._internalGraphicsLayer),this._setUpdateOperationHandle(r,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:r.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)null==i.geometry||"mesh"===i.geometry.type||(0,M.aI)(i.geometry.spatialReference,t.spatialReference)||((0,w.canProjectWithoutEngine)(i.geometry.spatialReference,t.spatialReference)||(0,w.isLoaded)()||await(0,w.load)(),i.geometry=(0,w.project)(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const i=[];t.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)}));const o=await t.hitTest(e,{exclude:i});return(0,Qe.zF)(o.results)}const i=[t.map.ground];t.map.allLayers.forEach((e=>{(0,T.Eq)(e.type)&&i.push(e)}));const o=await t.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(e.distance??0)>-Math.min(3*o.ground.distance,"global"===t.viewingMode?(0,E.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async e=>{const t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))}),x.o.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer((()=>this._getFirstHit((0,Je.ZV)(e))));let i=null;if(null!=t){const o=t.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),i=o):"2d"!==this.view?.type||this._isComponentGraphic(o)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==i||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const o={hasZ:"3d"===i.type,...this.defaultCreateOptions,...t},a=await this._setupDrawGraphicTool(e,i,o);return null==a?null:(i.tools.add(a),i.activeTool=a,this._setupCreateOperationHandle(a))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:o,defaultZ:a,hasZ:n,geometryToPlace:r,graphicProperties:s,mode:p,preserveAspectRatio:l}=i,c=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":e??("rectangle"===t||"circle"===t?"hybrid":"click")}(p,e),h=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}(e),d=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},u=d?.preserveAspectRatio??l??"rectangle"!==e,y={centered:"rectangle"!==e&&!("circle"===e&&!u),cursor:o,defaultZ:a,forceUniformSize:u,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:r,geometryType:h,mode:c,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:n,snappingManager:this.snappingManager,snapToScene:!1,view:t,...d};return"2d"===t.type?this._makeDrawGraphicTool2D(y):this._makeDrawGraphicTool3D(y)}async _makeDrawGraphicTool2D(e){const[t,o,a]=await Promise.all([this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(8004),i.e(4394),i.e(9218),i.e(866)]).then(i.bind(i,98954))),Ye(),We()]);return mt(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ct(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a})}async _makeDrawGraphicTool3D(e){const[t,o,a]=await Promise.all([this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375))),Ye(),We()]);if(mt(t)||this.destroyed)return null;const{elevationInfo:n}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:n,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const o=e.forceUniformSize,a=e.centered,r=[t.on("key-down",(t=>{if(t.key===L.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===L.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==L.NE.vertexAdd||t.repeat)t.key===L.NE.undo?(t.stopPropagation(),p.undo()):t.key===L.NE.redo?(t.stopPropagation(),p.redo()):t.key!==L.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===L.NE.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!o,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),x.o.WIDGET),t.on("key-up",(t=>{t.key===L.NE.pan?e.enabled=!0:t.key!==L.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===L.NE.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=o,t.stopPropagation())}),x.o.WIDGET),e.on("vertex-add",(t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?p&&p.cancel():p&&p.complete()})),(0,s.wB)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],p=new it({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{(0,n.ei)(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:o}=this;if(!o)return this._logMissingView(),null;const a={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let n=a.tool??rt.tool;for(const t of e)i.remove(t),i.add(t);if("3d"===o.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,a,o,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],a,o);case"transform":return this._setupGraphicTransform3DOperation(e,a,o)}}switch(n){case"move":return this._setupMove2DOperation(e,a,o);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,n,a,o);case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,a,o)}}async _setupMove3DOperation(e,t,o,a,r=!1){const[s,p]=await Promise.all([this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375))),We()]);if(mt(s))return s;const{ManipulatedObject3DGraphic:l,MoveTool3D:c}=s.module,h=new Map,d=()=>{h.forEach((e=>e.destroy())),h.clear()};for(const t of e){const e=new l({view:o,graphic:t}),i=(0,D.Y)(e);if(i!==k.d.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,k.c)(i)}).`),null;h.set(t,e)}const u=new c({view:o,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:p});o.tools.add(u),u.objects.addMany(Array.from(h.values())),r||this.updateGraphics.addMany(e);const y=[],g=new ot({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,n.ei)(y),vt(o,u),d()},undo:()=>{yt(this.view,u),ht(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{dt(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:e=>{this.updateGraphics.push(e);const t=new l({view:o,graphic:e});h.set(e,t),u.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(g.history.undo.forEach((e=>e.updates.splice(t,1))),g.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void g.complete();const i=h.get(e);i&&(u.objects.remove(i),i.destroy(),h.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==a)return;const e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,o,!0);i&&!mt(i)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(i,t))}});return y.push(...this._getHandlesForComponent(g,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(g,e,t)),x.o.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)}),x.o.WIDGET)),g}_setupGraphicTransform3DOperation(e,t,i,o=!1){if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return k.d.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return k.d.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return k.d.SUPPORTED;default:return k.d.GEOMETRY_TYPE_UNSUPPORTED}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,H.ky)(e)&&(0,H.NN)(e)?k.d.ELEVATION_MODE_UNSUPPORTED:k.d.SUPPORTED:k.d.SYMBOL_TYPE_UNSUPPORTED}(e[0])===k.d.SUPPORTED){const a=e[0],n=a.geometry;if(null!=n&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(a,t,i);if(null!=n&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(a,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const a="transform",{enableRotation:r,enableScaling:s,enableZ:p}=t,l=await this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375)));if(mt(l))return l;const{TransformTool3D:c,ManipulatedObject3DGraphic:h}=l.module,d=new h({graphic:e,view:o}),u=new c({object:d,view:o,enableRotation:r,enableScaling:s,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(u),this.updateGraphics.add(e);const y=[],g=new ot({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,n.ei)(y),vt(o,u),d.destroy()},undo:()=>{yt(this.view,u),ht(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{dt(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);mt(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(g,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(g,e,t)),x.o.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)}),x.o.WIDGET)),g}async _setupPolyTransform3DOperation(e,t,o,a=!1){const r="transform",{enableRotation:s,enableScaling:p,enableZ:l,preserveAspectRatio:c}=t,[h,d]=await Promise.all([this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375))),We()]);if(mt(h))return h;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:y}=h.module,g=this.view?.inputManager?.isModifierKeyDown(L.NE.constraint),v=new u({view:o,graphic:e}),m=new y({object:v,view:o,enableRotation:s,enableScaling:p,enableZ:l,preserveAspectRatio:!!c!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});o.tools.add(m),a||this.updateGraphics.add(e);const f=[],_=new ot({activeComponent:m,tool:r,type:"update",onEnd:()=>{(0,n.ei)(f),vt(o,m),v.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),_.onEnd(),_.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);mt(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),_.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const i=await this._setupReshape3DOperation(e,t,o,!0);i&&!mt(i)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(i,t))}});return f.push(...this._getHandlesForComponent(_,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(_,e,t)),x.o.WIDGET),o.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(_,e)),x.o.WIDGET),o.on("key-down",(e=>{e.key!==L.NE.constraint||e.repeat||(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())}),x.o.WIDGET),o.on("key-up",(e=>{e.key===L.NE.constraint&&(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())}),x.o.WIDGET)),_}async _setupMove2DOperation(e,t,i){const o="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=await this._getGraphicMover(e,t,i);if(mt(a))return a;const r=new ot({activeComponent:a,tool:o,type:"update",onEnd:()=>{this._displayDefaultCursor(),(0,n.ei)(l),(0,n.ei)(p),a.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ht(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:o})},redo:()=>{const e=this.updateGraphics.toArray();dt(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:o})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=i:r.complete()}});let s=!1;const p=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,t)),x.o.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==L.NE.constraint||e.repeat||(s=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),x.o.WIDGET),i.on("key-up",(e=>{e.key===L.NE.constraint&&s&&(s=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),x.o.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,o,a=!1){const r="reshape",[s,p,l]=await Promise.all([this._requireModule(Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(9507),i.e(9644),i.e(8004),i.e(356),i.e(4394),i.e(9218),i.e(2872),i.e(8915),i.e(4808),i.e(1843),i.e(2708)]).then(i.bind(i,84375))),Ye(),We()]);if(mt(s))return s;const{ManipulatedObject3DGraphic:c,ReshapeTool3D:h}=s.module,d=new c({view:o,graphic:e}),u=I(d);if(u!==k.d.SUPPORTED)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,k.c)(u)}).`),null;const y=t.reshapeOptions,g=new h({view:o,object:d,enableZVertex:t.enableZ&&"move"===y?.vertexOperation,enableZShape:t.enableZ&&"move"===y?.shapeOperation,enableMoveObject:"move"===y?.shapeOperation||"move-xy"===y?.shapeOperation,enableMidpoints:"split"===y?.edgeOperation,enableEdgeOffset:"offset"===y?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l});o.tools.add(g),a||this.updateGraphics.add(d.graphic);const v=[],m=new ot({activeComponent:g,tool:r,type:"update",onEnd:()=>{(0,n.ei)(v),vt(o,g),d.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);mt(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);mt(e)||this._setUpdateOperationHandle(e,t)}});return v.push(...this._getHandlesForComponent(m,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(m,e,t)),x.o.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)}),x.o.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,i,o){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(mt(a))return a;const r=new ot({activeComponent:a,type:"update",onEnd:()=>{(0,n.ei)(p),(0,n.ei)(s),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ht(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{dt(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const a=await this._setupTransformOrReshape2DOperation(t,"transform",i,o);if(mt(a))return;this._setUpdateOperationHandle(a,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)r.complete();else{const e=i[0].geometry;1!==i.length||null==e||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=i:r.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let a=null;"transform"===r.tool?a=await this._getReshape([e],i,o):"reshape"===r.tool&&(a=await this._getBox([e],i,o)),mt(a)||(r.activeComponent?.destroy(),r.activeComponent=a,r.activeComponent&&((0,n.ei)(p),p=this._getHandlesForComponent(r,i)))}}),s=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,i)),x.o.WIDGET),o.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key===L.NE.constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),x.o.WIDGET),o.on("key-up",(e=>{if(e.key===L.NE.constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),x.o.WIDGET)];let p=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:a,highlightOptions:n}=t,r=await this._requireModule(i.e(7263).then(i.bind(i,27263)));return mt(r)?r:new r.module.default({enableMoveAllGraphics:a,highlightName:n?.name,highlightsEnabled:!!n?.enabled,indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:a,enableScaling:n,highlightOptions:r,preserveAspectRatio:s}=t,[p,l]=await Promise.all([this._requireModule(Promise.all([i.e(8004),i.e(6263),i.e(4168)]).then(i.bind(i,4168))),We()]);if(mt(p))return p;const c=this.view?.inputManager?.isModifierKeyDown(L.NE.constraint);return new p.module.default({graphics:e,enableRotation:a,enableScaling:n,highlightName:r?.name,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!s!=!!c,layer:this._internalGraphicsLayer,view:o,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){const{highlightOptions:a,reshapeOptions:n}=t,r="split"===n?.edgeOperation,s="move"===n?.shapeOperation,[p,l,c]=await Promise.all([this._requireModule(Promise.all([i.e(8004),i.e(4394),i.e(2882),i.e(6263),i.e(2993)]).then(i.bind(i,2993))),Ye(),We()]);return mt(p)?p:new p.module.default({enableMidpoints:r,enableMovement:s,graphic:e[0],highlightName:a?.name,highlightsEnabled:!!a?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:c,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const o=e.map((e=>(0,S.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:o,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const o=e.map((e=>(0,S.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:o,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",(({graphic:i,viewEvent:o})=>{o.native?.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(i))})),i.on("graphic-move-start",(t=>e.addToHistory(gt(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(gt(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(gt(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(gt(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(gt([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(gt([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(gt([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(gt([t.oldGraphic]))))];case"move-3d":return[i.events.on("record-undo",(({updates:t})=>{e.addToHistory({updates:t})})),i.events.on("move-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})})),i.events.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})})),i.events.on("move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.events.on("record-undo",(({updates:t})=>{e.addToHistory({updates:t})})),i.events.on("translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.events.on("translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.events.on("rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.events.on("rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.events.on("scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.events.on("scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.events.on("translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.events.on("rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.events.on("scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.events.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})})),i.events.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})})),i.events.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.events.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.events.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()}))]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:o,viewEvent:a}=i;return a.native?.shiftKey&&o.layer===this.layer?(a.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(a.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=(0,Je.ZV)(t),a=await t.defer((()=>this._getFirstHit(o)));null!=a&&(t.native.shiftKey&&this._toggleSelection([a.graphic],e,i)||this.updateGraphics.includes(a.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some((e=>!(null==e||!o||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===L.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===L.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===L.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&L.NE.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===i.length&&"point"===i[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,r.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&"move"!==this.view.cursor&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){l.A.getLogger(this).error(new f.A(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return(0,s.C_)((()=>!this.updating))}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,r.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,b.qr)((0,s.C_)((()=>e?.ready)),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",lt("view"))}_logMissingLayer(){this._logError(pt,lt("layer"))}};(0,o._)([(0,p.MZ)()],st.prototype,"_defaultSnappingManager",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"updating",null),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"_updatingHandles",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"_operationHandle",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"activeTool",null),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"activeCreateToolDrawMode",null),(0,o._)([(0,p.MZ)()],st.prototype,"activeTooltip",null),(0,o._)([(0,p.MZ)({types:A.Es})],st.prototype,"activeFillSymbol",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"activeLineSymbol",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"activeVertexSymbol",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"allowDeleteKey",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"createGraphic",null),(0,o._)([(0,p.MZ)()],st.prototype,"defaultCreateOptions",null),(0,o._)([(0,p.MZ)()],st.prototype,"defaultUpdateOptions",null),(0,o._)([(0,p.MZ)({type:N.A,nonNullable:!0})],st.prototype,"labelOptions",null),(0,o._)([(0,p.MZ)()],st.prototype,"layer",void 0),(0,o._)([(0,p.MZ)({types:A.Es})],st.prototype,"pointSymbol",void 0),(0,o._)([(0,p.MZ)({types:A.Es})],st.prototype,"polygonSymbol",void 0),(0,o._)([(0,p.MZ)({types:A.Es})],st.prototype,"polylineSymbol",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"meshSymbol",void 0),(0,o._)([(0,p.MZ)({type:K,nonNullable:!0})],st.prototype,"snappingOptions",null),(0,o._)([(0,p.MZ)()],st.prototype,"snappingManager",null),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"state",null),(0,o._)([(0,p.MZ)({type:F.A,nonNullable:!0})],st.prototype,"tooltipOptions",null),(0,o._)([(0,p.MZ)({readOnly:!0})],st.prototype,"updateGraphics",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"updateOnGraphicClick",void 0),(0,o._)([(0,p.MZ)()],st.prototype,"creationMode",void 0),(0,o._)([(0,p.MZ)({type:V.A,nonNullable:!0})],st.prototype,"valueOptions",null),(0,o._)([(0,p.MZ)({types:A.Es})],st.prototype,"vertexSymbol",void 0),(0,o._)([(0,p.MZ)({value:null})],st.prototype,"view",null),(0,o._)([(0,p.MZ)({constructOnly:!0,type:Z.A})],st.prototype,"sketchOptions",void 0),st=(0,o._)([(0,c.$)("esri.widgets.Sketch.SketchViewModel")],st);const pt="sketch:missing-property",lt=e=>`Property '${e}' is missing on SketchViewModel.`;function ct(e){return"polygon"===e||"rectangle"===e||"circle"===e}function ht(e,t){ut("undo",e.history.undo,e.history.redo,t)}function dt(e,t){ut("redo",e.history.redo,e.history.undo,t)}function ut(e,t,i,o){const a=t.pop();if(!a)return;const n=a.updates,r=[];o.forEach(((t,i)=>{const o=n[i];null!=o&&("geometry"in o&&null!=o.geometry&&(r.push({geometry:t.geometry}),t.geometry=o.geometry),"symbol"in o&&null!=o.symbol&&(r.push({symbol:t.symbol}),t.symbol=o.symbol),"undo"in o&&(r.push(o),o[e](t)))})),i.push({updates:r})}function yt(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function gt(e){return{updates:e.map((({geometry:e})=>"mesh"===e?.type?{geometry:e.cloneShallow()}:{geometry:e}))}}function vt(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function mt(e){return"requireError"in e&&"aborted"===e.requireError}function ft(e,t){e.networkFeature=t}function _t(e){return e.networkFeature}function bt(e){return"point"===e?.type||"polyline"===e?.type||"polygon"===e?.type}let Et=class extends a.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new d.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new h.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(const t of e.graphics)_t(t).geometry=bt(t.geometry)?t.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const t of e.graphics){const e=_t(t);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){const t=e.graphic.geometry?.clone(),i=e.graphic.symbol?.clone();if(!t)break;switch(this._createMode){case"stop":{if("point"!==t.type)break;const{stops:i}=this.layer;if(i.length>0&&i.every((({geometry:e})=>!e))){i.at(0).geometry=t;break}if(i.length>1&&i.filter(((e,t)=>0!==t)).every((({geometry:e})=>!e))){i.at(1).geometry=t;break}const o=new v.A({geometry:t});i.add(o),ft(e.graphic,o);break}case"point-barrier":{if("point"!==t.type)break;const o=new u.A({geometry:t,symbol:i});this.layer.pointBarriers.add(o),ft(e.graphic,o);break}case"polyline-barrier":{if("polyline"!==t.type)break;const o=new g.A({geometry:t,symbol:i});this.layer.polylineBarriers.add(o),ft(e.graphic,o);break}case"polygon-barrier":{if("polygon"!==t.type)break;const o=new y.A({geometry:t,symbol:i});this.layer.polygonBarriers.add(o),ft(e.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){const t=_t(e.graphic);return{...e,networkFeature:t}}(e):function(e){const t=e.graphics.map((e=>_t(e)));return{...e,networkFeatures:t}}(e))}}initialize(){this._sketchViewModel=new st({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,s.wB)((()=>this.enabled),(e=>{e?this._activate():this._deactivate()}),s.Vh),(0,s.wB)((()=>{const{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}}),(()=>{this.enabled&&this._loadClonedGraphics()})),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,n.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.pR)(this._graphicsLayer),this._sketchViewModel=(0,r.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map((e=>_t(e)))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find((t=>_t(t)===e));t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap((e=>e.toArray().map((e=>{const t=e.toGraphic();return t.networkFeature=e,t}))));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,o._)([(0,p.MZ)()],Et.prototype,"enabled",void 0),(0,o._)([(0,p.MZ)({constructOnly:!0})],Et.prototype,"layer",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],Et.prototype,"selectedNetworkFeatures",null),(0,o._)([(0,p.MZ)()],Et.prototype,"updating",null),(0,o._)([(0,p.MZ)({constructOnly:!0})],Et.prototype,"view",void 0),Et=(0,o._)([(0,c.$)("esri.views.2d.layers.support.RouteLayerInteraction")],Et)},15462:function(e,t,i){i.d(t,{C:function(){return o}});class o{constructor(e,t,i,o){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=o}}},28488:function(e,t,i){i.d(t,{o:function(){return p}});var o=i(46984),a=i(27601),n=i(76362),r=i(15462),s=i(56142);class p extends r.C{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:r}){super(i,new o.WG(e,t),r,a.n.SELF),this._referenceLineHint=new s.c(n.H3.REFERENCE_EXTENSION,e,t,r,this.domain)}get hints(){return[this._referenceLineHint,new s.c(n.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}},37684:function(e,t,i){i.d(t,{c:function(){return a},d:function(){return o}});var o;i(6273);function a(e){switch(e){case o.SUPPORTED:break;case o.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case o.GEOMETRY_MISSING:return"no geometry";case o.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case o.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case o.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(o||(o={}))},45660:function(e,t,i){i.d(t,{Fm:function(){return p},Q7:function(){return l}});var o=i(82444),a=i(80347),n=i(19913),r=i(94669);i(11631);function s(e){return e?{p0:(0,n.o8)(e.p0),p1:(0,n.o8)(e.p1),p2:(0,n.o8)(e.p2)}:{p0:(0,n.vt)(),p1:(0,n.vt)(),p2:(0,n.vt)()}}function p(e,t,i){const o=t[0]-e[0],a=t[1]-e[1],n=i[0]-e[0],r=i[1]-e[1];return.5*Math.abs(o*r-a*n)}function l(e,t,i){return(0,a.d)(c,t,e),(0,a.d)(h,i,e),.5*(0,a.l)((0,a.h)(c,c,h))}new o.I(r.vt),new o.I((()=>s()));const c=(0,n.vt)(),h=(0,n.vt)()},46174:function(e,t,i){i.d(t,{Hh:function(){return r},fz:function(){return p},g7:function(){return s},s1:function(){return n}});var o=i(89349);let a;function n(){return!!a&&(0,o.i)()}async function r(){if(!n()){const[e,t]=await Promise.all([Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(4479)]).then(i.bind(i,46840)),Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(6530)]).then(i.bind(i,45262)).then((e=>e.aG)).then((({injectPe:e})=>e)),(0,o.l)()]);a=new e.OperatorGeodeticLength,t(o.p)}}function s(e,t,i){return a.execute(e,t,i,null)}function p(){return a.supportsCurves()}},48257:function(e,t,i){i.d(t,{HJ:function(){return h},_b:function(){return a},pn:function(){return o}});var o,a,n,r=i(27601),s=i(76362),p=i(15462),l=i(56142),c=i(43457);class h extends p.C{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:o,otherVertexType:n,isDraped:s,selfSnappingType:p,objectId:l,domain:c}){super(e,t,s,c??r.n.SELF),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=n,this.selfSnappingType=p??a.None,this.objectId=l??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===o.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===o.CENTER?this.targetPoint:this.otherVertex;return[new l.c(s.H3.TARGET,t,i,this.isDraped,this.domain),new l.c(s.H3.REFERENCE,e,t,this.isDraped,this.domain),new c.l(this.previousVertex,t,i,this.isDraped,this.domain)]}}(n=o||(o={}))[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER",function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(a||(a={}))},53909:function(e,t,i){i.d(t,{N:function(){return s}});var o=i(46984),a=i(27601),n=i(15462),r=i(46997);class s extends n.C{constructor(e,t,i,n){super(e,new o.i7(e),n,a.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new r.v(this.targetPoint,this.isDraped,this.domain)]}}},57945:function(e,t,i){i.d(t,{R:function(){return u}});var o=i(53334),a=i(80347),n=i(19913),r=i(46984),s=i(93617),p=i(27601),l=i(76362),c=i(15462),h=i(56142),d=i(43457);class u extends c.C{constructor({targetPoint:e,point1:t,point2:i,isDraped:l}){super(e,new r.ej((0,s._7)((0,a.m)((0,n.vt)(),t,i,.5)),.5*(0,o.Io)((0,s.Xz)(t),(0,s.Xz)(i))),l,p.n.SELF),this._p1=t,this._p2=i}get hints(){return[new h.c(l.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new h.c(l.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new d.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}},62453:function(e,t,i){i.d(t,{z:function(){return s}});var o=i(46984),a=i(76362),n=i(86876),r=i(56142);class s extends n.w{constructor(e){super({...e,constraint:new o.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new r.c(a.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},64010:function(e,t,i){i.d(t,{Y:function(){return n}});i(6273);var o=i(19541),a=i(37684);function n(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return a.d.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return a.d.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return a.d.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return(0,o.wz)(i)?a.d.ELEVATION_MODE_UNSUPPORTED:a.d.SUPPORTED}},65680:function(e,t,i){i.d(t,{e:function(){return d},g:function(){return u},i:function(){return c},l:function(){return h},s:function(){return l}});var o=i(5262),a=i(46174),n=i(65897);let r,s,p,l;function c(){return!!r&&(0,a.s1)()}async function h(){if(!c()){const[e]=await Promise.all([Promise.all([i.e(4720),i.e(4733),i.e(5262),i.e(7586),i.e(4973)]).then(i.bind(i,43153)),(0,a.Hh)()]);r=e.fromGeometry,s=e.fromSpatialReference,p=e.getSpatialReference,l=(0,a.fz)()}}function d(e,t={}){const{curveType:i="geodesic",unit:l}=t,c=p(e);let h=(0,a.g7)(r(e),s(c),n.O[i]);return h&&l&&(h=(0,o.oU)(h,"meters",l)),h}const u=Object.freeze(Object.defineProperty({__proto__:null,execute:d,isLoaded:c,load:h,get supportsCurves(){return l}},Symbol.toStringTag,{value:"Module"}))},65897:function(e,t,i){i.d(t,{O:function(){return o}});const o={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4}},84739:function(e,t,i){i.d(t,{X:function(){return s}});var o=i(23572),a=(i(53334),i(80347)),n=i(19913),r=i(19541);function s(e,t,i,o,s=(0,n.vt)()){const l=(0,a.c)(p,e);return l[2]=(0,r.xS)(o,l,t,i)||0,o.renderCoordsHelper.toRenderCoords(l,t,s),s}const p=(0,n.vt)();(0,o.QG)(),(0,o.QG)()},86876:function(e,t,i){i.d(t,{w:function(){return n}});var o=i(27601),a=i(15462);class n extends a.C{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:a}){super(e,i,a,o.n.FEATURE),this.objectId=t}}},88515:function(e,t,i){i.d(t,{X:function(){return s}});var o=i(46984),a=i(76362),n=i(86876),r=i(56142);class s extends n.w{constructor(e){super({...e,isDraped:!0,constraint:new o.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new r.c(a.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95101:function(e,t,i){i.d(t,{B:function(){return d}});var o=i(80347),a=i(19913),n=i(46984),r=i(93617),s=i(27601),p=i(76362),l=i(15462),c=i(56142),h=i(27411);class d extends l.C{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:p}){const l=(0,a.o8)(t),{left:c,right:h}=e;(0,o.d)(l,(0,o.f)(l,l,h),c),super(i,new n.WG(t,(0,r._7)(l)),p,s.n.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new c.c(p.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new h.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new c.c(p.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,o.q)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,o.q)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,o.q)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,o.q)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}}}]);