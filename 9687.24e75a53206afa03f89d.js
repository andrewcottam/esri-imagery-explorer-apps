"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[4274,9687],{74274:function(e,t,n){n.d(t,{EG:function(){return p},Ll:function(){return I},R3:function(){return h},UH:function(){return l},aM:function(){return g},fs:function(){return d},i0:function(){return F}});var r=n(50189),i=n(46227),o=(n(6183),n(68717)),u=n(82506),a=n(23375);const l=",",s={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},f=new Set(["integer","small-integer"]);let c=null;function d(e){return(0,i.vE)(e)||(0,i.zD)(e)||(0,i.Ah)(e)}async function p(e){const{field:t,field2:n,field3:r,normalizationField:i,valueExpression:u}=e;let a=[];if(u){if(!c){const{arcadeUtils:e}=await(0,o.l)();c=e}a=c.extractFieldNames(u)}return t&&a.push(t),n&&a.push(n),r&&a.push(r),i&&a.push(i),a}function y(e){return String(e).padStart(2,"0")}function m(e,t,n){let r;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),r=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${y((n?e.getMonth():e.getUTCMonth())+1)}-${y(n?e.getDate():e.getUTCDate())} ${y(n?e.getHours():e.getUTCHours())}:${y(n?e.getMinutes():e.getUTCMinutes())}:${y(n?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function g(e,t,n,r){const{hasQueryEngine:i}=e,o=`(${m(n,b(e,n),i)} - ${m(t,b(e,t),i)})`;let u=s[r],a="/";return u<1&&(u=1/u,a="*"),{sqlExpression:1===u?o:`(${o} ${a} ${u})`,sqlWhere:null}}function b(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,i.vE)(n))return"field"}}function h(e,t){const n=t&&e.getField(t);return!!n&&f.has(n.type)}function I(e){return`cast(${e} as float)`}function F(e,t){const{format:n,timeZoneOptions:i,fieldType:o}=t??{};let l,s;if(i&&({timeZone:l,timeZoneName:s}=(0,a.hv)(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,(0,r.J2)(n||"short-date-short-time"),o)),"string"==typeof e&&isNaN(Date.parse("time-only"===o?`1970-01-01T${e}Z`:e)))return e;switch(o){case"date-only":{const t=(0,r.J2)(n||"short-date");return"string"==typeof e?(0,r.iS)(e,{...t}):(0,r.Yq)(e,{...t,timeZone:u.n$})}case"time-only":{const t=(0,r.J2)(n||"short-time");return"string"==typeof e?(0,r.F8)(e,t):(0,r.Yq)(e,{...t,timeZone:u.n$})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||i?(0,r.J2)(n||"short-date-short-time"):void 0,o=t?{...t,timeZone:l,timeZoneName:s}:void 0;return"string"==typeof e?(0,r.Ey)(e,o):(0,r.Yq)(e,o)}default:{const t=n||i?(0,r.J2)(n||"short-date-short-time"):void 0;return(0,r.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:l,timeZoneName:s}:void 0)}}}},79687:function(e,t,n){n.r(t),n.d(t,{applyTextFormattingHTML:function(){return B},createFieldInfoMap:function(){return Q},findRelatedLayer:function(){return ae},findUtilityNetwork:function(){return le},fixTokens:function(){return R},formatAttributes:function(){return W},formatEditInfo:function(){return _},formatValueToFieldInfo:function(){return G},getAllFieldInfos:function(){return P},getFieldInfo:function(){return Y},getFieldInfoLabel:function(){return q},getFixedFieldName:function(){return v},getFixedFieldNames:function(){return E},getSourceLayer:function(){return N},graphicCallback:function(){return Z},htmlEntities:function(){return V},isAssociatedFeatureSupportedLayer:function(){return O},isExpressionField:function(){return x},isFeatureSupportedLayer:function(){return D},isGraphicForRelatableFeatureSupportedLayer:function(){return H},isRelatableFeatureSupportedLayer:function(){return z},isRelatableLayer:function(){return j},isRelatedField:function(){return te},preLayerQueryCallback:function(){return oe},preRequestCallback:function(){return ue},querySourceLayer:function(){return X},queryUpdatedFeature:function(){return ee},shouldOpenInNewTab:function(){return C},substituteAttributes:function(){return M},substituteFieldsInLinksAndAttributes:function(){return $}});var r=n(6273),i=n(80861),o=n(21332),u=n(50189),a=n(18632),l=n(46227),s=n(65452),f=n(74274),c=n(68717),d=n(23375);const p=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),y=/href=(""|'')/gi,m=/(\{([^{\r\n]+)\})/g,g=/'/g,b=/^\s*expression\//i,h=/(\n)/gi,I=/[\u00A0-\u9999<>&]/gim,F=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,w="relationships/",L=(0,u.J2)("short-date-short-time");function N(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function Z({type:e,value:t,event:n}){try{return"function"==typeof t?t(n):await t}catch(r){return void p().error("error",`An error occurred when calling the "${e}" function`,{error:r,graphic:n.graphic,value:t})}}function C(e=""){if(e)return!T.test(e.trim().toLowerCase())}function x(e){return!!e&&b.test(e)}function q(e,t){const n=function(e,t){if(!t||!x(t)||!e)return;const n=t.replace(b,"").toLowerCase();return e.find((({name:e})=>e.toLowerCase()===n))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function v(e,t){const n=A(t,e);return n?n.name:e}function E(e,t){return e&&e.map((e=>v(e,t)))}function A(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function U(e){return`${e}`.trim()}function $({attributes:e,globalAttributes:t,layer:n,text:r,expressionAttributes:i,fieldInfoMap:o}){return r?M({formattedAttributes:t,template:S(r,{...t,...i,...e},n),fieldInfoMap:o}):""}function M({formattedAttributes:e,template:t,fieldInfoMap:n}){return U(function(e){return e.replaceAll(y,"")}((0,o.HC)((0,o.HC)(t,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,n))),e)))}function k(e,t=!1){const n={...e};return Object.keys(n).forEach((e=>function(e,t,n=!1){const r=t[e];if("string"==typeof r){const i="%27",o=(n?encodeURIComponent(r):r).replaceAll(g,i);t[e]=o}}(e,n,t))),n}function R(e,t){return e.replaceAll(m,((e,n,r)=>{const i=A(t,r);return i?`{${i.name}}`:n}))}function S(e,t,n){const r=R(e,n);return r?r.replaceAll(F,((e,n,r)=>function(e,t,n){const r=(t=U(t))&&"{"!==t[0];return(0,o.HC)(e,k(n,r||!1))}(e,n||r,t))):r}function D(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function j(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function z(e){return D(e)&&j(e)}function O(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function H(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&z(e.sourceLayer)}function G(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:i,layer:o,timeZone:u}=t,s=Y(n,r),c=A(o,r);if(s&&!(0,l.JL)(r)){const t=c?.type,n=s.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,f.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o)||!o.datesInUnknownTimezone)}})}const d=s?.format;return"string"==typeof e&&(0,l.JL)(r)&&d?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?J(e,",",", ",t):e.includes(";")?J(e,";","; ",t):e.includes(" ")?J(e," "," ",t):(0,a.ZV)(Number(e),(0,a.yx)(t))}(e,d):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,d))||null==e||null==d?B(e):(0,a.ZV)(e,i?{...(0,a.yx)(d),minimumFractionDigits:0,maximumFractionDigits:20}:(0,a.yx)(d))}function J(e,t,n,r){return e.trim().split(t).map((e=>(0,a.ZV)(Number(e),(0,a.yx)(r)))).join(n)}function Y(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function _(e,t,n,r){const{creatorField:i,creationDateField:o,editorField:a,editDateField:l}=e;if(!t)return;const s=(0,d.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r)||!r.datesInUnknownTimezone),n,L,"date"),f={...L,...s},c=t[l];if("number"==typeof c){const e=t[a];return{type:"edit",date:(0,u.Yq)(c,f),user:e}}const p=t[o];if("number"==typeof p){const e=t[i];return{type:"create",date:(0,u.Yq)(p,f),user:e}}return null}function Q(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=v(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function P(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function V(e){return e.replaceAll(I,(e=>`&#${e.charCodeAt(0)};`))}function B(e){return"string"==typeof e?e.replaceAll(h,'<br class="esri-text-new-line" />'):e}function K(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:o,layer:u,graphic:a,timeZone:s}=e;if(null==t)return"";const c=function({fieldName:e,value:t,graphic:n,layer:i}){if(te(e))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;const o=n&&i.getFieldDomain(e,{feature:n,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return o&&"coded-value"===o.type?o.getName(t):null}({fieldName:n,value:t,graphic:a,layer:u});if(c)return c;const d=function({fieldName:e,graphic:t,layer:n}){if(te(e))return null;if(!n||"function"!=typeof n.getFeatureType)return null;const{typeIdField:r}=n;if(!r||e!==r)return null;const i=n.getFeatureType(t);return i?i.name:null}({fieldName:n,graphic:a,layer:u});if(d)return d;if(o.get(n.toLowerCase()))return G(t,{fieldInfos:i||Array.from(o.values()),fieldName:n,layer:u,timeZone:s});const p=u?.fieldsIndex?.get(n);return p&&((0,f.fs)(p)||(0,l.OH)(p))?(0,f.i0)(t,{fieldType:p.type,timeZoneOptions:{layerTimeZone:u&&"preferredTimeZone"in u?u.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!u||!("datesInUnknownTimezone"in u)||!u.datesInUnknownTimezone)}}):B(t)}function W({fieldInfos:e,attributes:t,layer:n,graphic:r,fieldInfoMap:i,relatedInfos:o,timeZone:u}){const a={};return o?.forEach((t=>function({attributes:e,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:o}){e&&t&&(t.relatedFeatures?.forEach((u=>ne({attributes:e,graphic:u,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:o}))),t.relatedStatsFeatures?.forEach((u=>ne({attributes:e,graphic:u,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:o}))))}({attributes:a,relatedInfo:t,fieldInfoMap:i,fieldInfos:e,layer:n,timeZone:u}))),t&&Object.keys(t).forEach((o=>{const l=t[o];a[o]=K({fieldName:o,fieldInfos:e,fieldInfoMap:i,layer:n,value:l,graphic:r,timeZone:u})})),a}async function X(e,t){const{layer:n,graphic:r,outFields:i,objectIds:o,returnGeometry:u,spatialReference:a}=e,l=o[0];if("number"!=typeof l&&"string"!=typeof l){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:l,requiredFields:i};return p().warn(e,t),null}if(!(0,s.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:u};return p().warn(e,t),null}const f=n.createQuery();return f.objectIds=o,f.outFields=i?.length?i:[n.objectIdField],f.returnGeometry=!!u,f.returnZ=!!u,f.returnM=!!u,f.outSpatialReference=a,(await n.queryFeatures(f,t)).features[0]}async function ee({graphic:e,popupTemplate:t,layer:n,spatialReference:r},i){if(!n||!t)return;if("function"==typeof n.load&&await n.load(i),!e.attributes)return;const o=n.objectIdField,u=e.attributes[o];if(null==u)return;const a=[u],s=await t.getRequiredFields(n.fieldsIndex),f=(0,l.Kl)(e,s),d=f?[]:s.includes(o)?s:[...s,o],p=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.l)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(t);if(f&&!p)return;const y=await X({layer:n,graphic:e,outFields:d,objectIds:a,returnGeometry:p,spatialReference:r},i);y&&(y.geometry&&(e.geometry=y.geometry),y.attributes&&(e.attributes={...e.attributes,...y.attributes}))}function te(e=""){return!!e&&e.includes(w)}function ne({attributes:e,graphic:t,relatedInfo:n,fieldInfos:r,fieldInfoMap:i,layer:o,timeZone:u}){e&&t&&n&&Object.keys(t.attributes).forEach((a=>{const l=function(e){return e?`${w}${e.layerId}/${e.fieldName}`:""}({layerId:n.relation.id.toString(),fieldName:a}),s=t.attributes[a];e[l]=K({fieldName:l,fieldInfos:r,fieldInfoMap:i,layer:o,value:s,graphic:t,timeZone:u})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ie=({layer:e,method:t,query:n,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const i=null!=n.where?n.where:null,o=null!=n.geometry?n.geometry:null;re(r)||re(i)||"extent"===o?.type||"tile"===n.resultType||(n.cacheHint=!0)},oe=({query:e,layer:t,method:n})=>{ie({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},ue=({queryPayload:e,layer:t,method:n})=>{ie({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function ae(e,t,n){return e&&t&&n?"sublayer"===t.type?fe({layers:t.layer?.allSublayers,map:e,relatedLayer:t,relationship:n})||fe({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):fe({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||fe({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function le(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function se(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function fe({map:e,relationship:t,relationship:{relatedTableId:n},relatedLayer:r,layers:i}){if(!i)return null;for(const o of i){if("map-image"===o.type){const n=fe({layers:o.sublayers,map:e,relatedLayer:r,relationship:t})||fe({layers:o.subtables,map:e,relatedLayer:r,relationship:t});if(n)return n;continue}if(!z(o))continue;if("sublayer"===r.type){if(o!==r&&o.id===n)return o.isTable?se(e,o):o;continue}const i="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!i)return null;if("sublayer"!==o.type){if(o!==r&&o.url===i&&o.layerId===n)return o}else if(o!==r&&o.layer?.url===i&&o.id===n)return o.isTable?se(e,o):o}return null}}}]);